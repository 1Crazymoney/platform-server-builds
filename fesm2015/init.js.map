{"version":3,"file":"init.js","sources":["../../../../../../packages/platform-server/src/domino_adapter.ts","../../../../../../packages/platform-server/init/src/shims.ts","../../../../../../packages/platform-server/init/src/init.ts","../../../../../../packages/platform-server/init/public_api.ts","../../../../../../packages/platform-server/init/index.ts","../../../../../../packages/platform-server/init/init.ts"],"sourcesContent":["/**\n * @license\n * Copyright Google LLC All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.io/license\n */\nconst domino = require('domino');\n\nimport {ɵBrowserDomAdapter as BrowserDomAdapter} from '@angular/platform-browser';\nimport {ɵsetRootDomAdapter as setRootDomAdapter} from '@angular/common';\n\nfunction _notImplemented(methodName: string) {\n  return new Error('This method is not implemented in DominoAdapter: ' + methodName);\n}\n\nexport function setDomTypes() {\n  // Make all Domino types available in the global env.\n  Object.assign(global, domino.impl);\n  (global as any)['KeyboardEvent'] = domino.impl.Event;\n}\n\n/**\n * Parses a document string to a Document object.\n */\nexport function parseDocument(html: string, url = '/') {\n  let window = domino.createWindow(html, url);\n  let doc = window.document;\n  return doc;\n}\n\n/**\n * Serializes a document to string.\n */\nexport function serializeDocument(doc: Document): string {\n  return (doc as any).serialize();\n}\n\n/**\n * DOM Adapter for the server platform based on https://github.com/fgnass/domino.\n */\nexport class DominoAdapter extends BrowserDomAdapter {\n  static makeCurrent() {\n    setDomTypes();\n    setRootDomAdapter(new DominoAdapter());\n  }\n\n  private static defaultDoc: Document;\n\n  log(error: string) {\n    // tslint:disable-next-line:no-console\n    console.log(error);\n  }\n\n  logGroup(error: string) {\n    console.error(error);\n  }\n\n  logGroupEnd() {}\n\n  supportsDOMEvents(): boolean {\n    return false;\n  }\n\n  createHtmlDocument(): HTMLDocument {\n    return parseDocument('<html><head><title>fakeTitle</title></head><body></body></html>');\n  }\n\n  getDefaultDocument(): Document {\n    if (!DominoAdapter.defaultDoc) {\n      DominoAdapter.defaultDoc = domino.createDocument();\n    }\n    return DominoAdapter.defaultDoc;\n  }\n\n  isElementNode(node: any): boolean {\n    return node ? node.nodeType === DominoAdapter.defaultDoc.ELEMENT_NODE : false;\n  }\n  isShadowRoot(node: any): boolean {\n    return node.shadowRoot == node;\n  }\n\n  getProperty(el: Element, name: string): any {\n    if (name === 'href') {\n      // Domino tries to resolve href-s which we do not want. Just return the\n      // attribute value.\n      return el.getAttribute('href');\n    } else if (name === 'innerText') {\n      // Domino does not support innerText. Just map it to textContent.\n      return el.textContent;\n    }\n    return (<any>el)[name];\n  }\n\n  getGlobalEventTarget(doc: Document, target: string): EventTarget|null {\n    if (target === 'window') {\n      return doc.defaultView;\n    }\n    if (target === 'document') {\n      return doc;\n    }\n    if (target === 'body') {\n      return doc.body;\n    }\n    return null;\n  }\n\n  getBaseHref(doc: Document): string {\n    const base = doc.documentElement!.querySelector('base');\n    let href = '';\n    if (base) {\n      href = base.getAttribute('href')!;\n    }\n    // TODO(alxhub): Need relative path logic from BrowserDomAdapter here?\n    return href;\n  }\n\n  dispatchEvent(el: Node, evt: any) {\n    el.dispatchEvent(evt);\n\n    // Dispatch the event to the window also.\n    const doc = el.ownerDocument || el;\n    const win = (doc as any).defaultView;\n    if (win) {\n      win.dispatchEvent(evt);\n    }\n  }\n\n  getHistory(): History {\n    throw _notImplemented('getHistory');\n  }\n  getLocation(): Location {\n    throw _notImplemented('getLocation');\n  }\n  getUserAgent(): string {\n    return 'Fake user agent';\n  }\n\n  performanceNow(): number {\n    return Date.now();\n  }\n\n  supportsCookies(): boolean {\n    return false;\n  }\n  getCookie(name: string): string {\n    throw _notImplemented('getCookie');\n  }\n}\n","/**\n * @license\n * Copyright Google LLC All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.io/license\n */\nimport {setDomTypes} from '../../src/domino_adapter';\n\n/**\n * Apply the necessary shims to make DOM globals (such as `Element`, `HTMLElement`, etc.) available\n * on the environment.\n */\nexport function applyShims(): void {\n  setDomTypes();\n}\n","/**\n * @license\n * Copyright Google LLC All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.io/license\n */\n\n/**\n * @module\n * @description\n * Entry point for all initialization APIs of the platform-server package.\n */\n\nimport {applyShims} from './shims';\n\napplyShims();\n","/**\n * @license\n * Copyright Google LLC All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.io/license\n */\n\n/**\n * @module\n * @description\n * Entry point for all public APIs of this package.\n */\nexport * from './src/init';\n","/**\n * @license\n * Copyright Google LLC All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.io/license\n */\n\n// This file is not used to build this module. It is only used during editing\n// by the TypeScript language service and during build for verifcation. `ngc`\n// replaces this file with production index.ts when it rewrites private symbol\n// names.\n\nexport * from './public_api';\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './index';\n"],"names":["BrowserDomAdapter","setRootDomAdapter"],"mappings":"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"}